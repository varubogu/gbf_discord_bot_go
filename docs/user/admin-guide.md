# 管理者ガイド

GBF Discord Bot のサーバー管理者向けの詳細な設定・運用ガイドです。

## 📋 目次

- [管理者の役割](#管理者の役割)
- [初期設定](#初期設定)
- [権限管理](#権限管理)
- [チャンネル設定](#チャンネル設定)
- [スプレッドシート連携](#スプレッドシート連携)
- [スケジュール管理](#スケジュール管理)
- [監視・運用](#監視運用)
- [トラブル対応](#トラブル対応)

## 👑 管理者の役割

### 基本的な責任
- **Bot の導入・設定**: サーバーへのBot招待と権限設定
- **権限管理**: ユーザーロールと権限の管理
- **チャンネル設定**: 募集・通知チャンネルの設定
- **運用監視**: Bot の動作状況監視とメンテナンス
- **ユーザーサポート**: 利用者の問題解決支援

### 必要なスキル
- Discord サーバー管理の基本知識
- Google Spreadsheet の基本操作（連携機能使用時）
- 基本的なトラブルシューティング

## ⚙️ 初期設定

### Step 1: Bot の招待
詳細は [セットアップガイド](setup-guide.md) を参照してください。

### Step 2: 基本ロールの作成

#### GBF Bot 用ロール
```
ロール名: GBF Bot
権限:
✅ メッセージを送信
✅ 埋め込みリンク
✅ ファイルを添付
✅ メッセージ履歴を読む
✅ メンション権限(@everyone, @here, 全ロール)
✅ リアクションを追加
✅ 外部の絵文字を使用する
✅ スラッシュコマンドを使う
```

#### Bot 管理者用ロール
```
ロール名: gbf_bot_control
権限: 基本設定のまま（特別な権限不要）
対象: 信頼できる管理者のみ
```

### Step 3: チャンネル構成の設計

#### 推奨チャンネル構成
```
📁 GBF関連
├── 📺 マルチ募集        # バトル募集専用
├── 📢 bot-通知         # イベント・スケジュール通知
└── 🔧 bot-管理         # 管理コマンド実行用（オプション）
```

## 🔒 権限管理

### 権限レベルの設計

| レベル | ロール | 権限 | 対象コマンド |
|--------|--------|------|--------------|
| **一般** | @everyone | 基本使用 | `/ping`, `/help`, `/battles`, `/recruit` |
| **管理** | `gbf_bot_control` | Bot管理 | `/reload`, `/status` + 一般権限 |
| **最高** | サーバー管理者 | 全機能 | 全てのコマンド |

### 権限設定のベストプラクティス

#### セキュリティ重視
```
✅ Do:
- 管理ロールは最小限の人数に付与
- 定期的な権限見直し
- 不要になった権限の即座削除
- 管理コマンドは専用チャンネルで実行

❌ Don't:
- 管理ロールを多数のユーザーに付与
- 権限の放置
- 公開チャンネルでの管理コマンド実行
```

#### 利便性重視
```
✅ Do:
- バトル募集は誰でも使用可能に
- ヘルプコマンドのアクセス制限なし
- わかりやすいロール名の使用

❌ Don't:
- 過度な権限制限
- 複雑すぎるロール構成
```

### チャンネル権限の詳細設定

#### マルチ募集チャンネル
```
@everyone の権限:
✅ チャンネルを見る
✅ メッセージを送信
✅ スラッシュコマンドを使う
✅ リアクションを追加
❌ メンションを送信（スパム防止）

GBF Bot の権限:
✅ 全て許可
```

#### 通知チャンネル
```
@everyone の権限:
✅ チャンネルを見る
❌ メッセージを送信
✅ リアクションを追加

GBF Bot の権限:
✅ 全て許可
```

#### 管理チャンネル（オプション）
```
@everyone の権限:
❌ チャンネルを見る

gbf_bot_control の権限:
✅ チャンネルを見る
✅ メッセージを送信
✅ スラッシュコマンドを使う

GBF Bot の権限:
✅ 全て許可
```

## 🗂️ スプレッドシート連携

### 概要
Python版の機能を継承し、Google Spreadsheet との連携でデータの一元管理が可能です。

### 必要な準備

#### Google Cloud Platform 設定
1. **プロジェクト作成** - GCP でプロジェクトを作成
2. **API 有効化** - Google Sheets API を有効化
3. **サービスアカウント作成** - Bot 用のサービスアカウント
4. **キーファイル取得** - JSON 形式の認証キー

#### スプレッドシート準備
1. **管理用スプレッドシート作成**
2. **サービスアカウントに共有権限付与**
3. **テンプレートシートの設定**

### データ管理機能

#### サーバー固有データ
- **スケジュール設定** - サーバー個別のイベント予定
- **メッセージテンプレート** - カスタムメッセージの管理
- **環境変数** - サーバー固有の設定値

#### 全サーバー共通データ
- **マルチバトル情報** - クエスト一覧とパラメータ
- **共通スケジュール** - 古戦場・イベント予定
- **共通メッセージ** - 標準的な通知文

### 運用手順

#### データ更新
1. **スプレッドシート編集** - Web interface で内容更新
2. **Bot への反映** - `/reload` コマンド実行
3. **動作確認** - `/status` で更新状況確認

#### バックアップ
- **自動バックアップ** - 定期的なデータ書き出し
- **履歴管理** - 変更履歴の保持
- **復旧手順** - 問題発生時の復元方法

## 📅 スケジュール管理

### 通知設定

#### 古戦場通知
```
自動通知タイミング:
- 開催3日前: 準備リマインド
- 開催1日前: 最終確認
- 予選開始: 戦闘開始通知
- 予選終了: 結果と本戦準備
- 本戦各日: 開始・中間・終了
- スペシャルバトル: 開始・終了
- 古戦場終了: 最終結果
```

#### カスタムイベント
```
団イベント例:
- 団サポート発動リマインド
- 定期集会の通知
- 特定時間の集合呼びかけ
- その他団独自のスケジュール
```

### 設定方法

#### スプレッドシート経由
1. **スケジュール表の編集**
2. **通知内容の設定**
3. **対象チャンネルの指定**
4. **Bot への反映** (`/reload`)

#### 手動設定（将来的な機能）
- Discord コマンドによる直接設定
- リアルタイム反映
- GUI ベースの設定interface

## 🔍 監視・運用

### 日常的な監視

#### Bot 状態確認
```
定期実行推奨:
/status
```
**確認項目:**
- オンライン状況
- 応答時間
- エラー発生状況
- 最終更新時刻

#### 利用状況監視
- **コマンド実行頻度**
- **募集投稿数**
- **エラー発生率**
- **ユーザーからの問い合わせ**

### メンテナンス作業

#### 定期メンテナンス
```
週次:
- 状態確認
- エラーログチェック
- 不要データの整理

月次:
- 権限設定の見直し
- スプレッドシートのバックアップ
- パフォーマンス評価
```

#### アップデート対応
1. **事前告知** - ユーザーへのメンテナンス通知
2. **バックアップ** - 設定・データの保存
3. **アップデート実行** - Bot の更新
4. **動作確認** - 全機能の動作テスト
5. **完了報告** - ユーザーへの完了通知

## ⚠️ トラブル対応

### 緊急時対応フロー

#### Level 1: 軽微な問題
```
対象: 特定機能の一時的な不具合
対応: 
1. /status で状況確認
2. /reload で設定再読み込み
3. 問題継続時は上位レベルへ
```

#### Level 2: 重要な問題
```
対象: 主要機能の停止、広範囲への影響
対応:
1. ユーザーへの状況報告
2. Bot 開発者への連絡
3. 代替手段の案内（手動募集等）
```

#### Level 3: 緊急事態
```
対象: Bot の完全停止、セキュリティ問題
対応:
1. 即座のユーザー告知
2. Bot 権限の一時停止（必要時）
3. 開発者・ホスティング事業者への緊急連絡
```

### よくある問題と対処法

#### 「Bot が応答しない」
1. **オンライン状況確認** - メンバーリストでステータス確認
2. **権限確認** - 必要権限の再確認
3. **Discord 障害** - [Discord Status](https://discordstatus.com/) 確認
4. **Bot再起動** - 開発者に連絡

#### 「コマンドエラーが多発」
1. **権限設定の確認** - チャンネル・ロール権限
2. **最近の変更確認** - サーバー設定の変更点
3. **ログの収集** - エラーメッセージのスクリーンショット
4. **開発者への報告** - 詳細情報と共に連絡

#### 「募集機能が動かない」
1. **埋め込み権限確認** - Embed Links 権限
2. **リアクション権限確認** - Add Reactions 権限
3. **チャンネル固有設定** - 該当チャンネルの権限
4. **別チャンネルでテスト** - 問題の切り分け

## 📊 運用データの活用

### 利用統計の収集
- **コマンド使用頻度**
- **人気のバトル種別**
- **アクティブユーザー数**
- **募集成功率**

### 改善への活用
- **ユーザビリティの向上**
- **機能追加の検討**
- **権限設定の最適化**
- **チャンネル構成の見直し**

## 📞 サポート体制

### 内部サポート
1. **FAQ 活用** - [FAQ](faq.md) への誘導
2. **マニュアル参照** - [利用者マニュアル](user-manual.md) の案内
3. **権限確認** - 個別の権限問題解決

### 外部サポート
1. **開発者連絡** - GitHub Issues, Discord 等
2. **コミュニティ** - ユーザー同士の情報共有
3. **ドキュメント更新** - FAQ・マニュアルの充実

---

**関連ドキュメント:**
- [利用者マニュアル](user-manual.md) - 基本的な使用方法
- [セットアップガイド](setup-guide.md) - 初回導入手順
- [FAQ](faq.md) - よくある質問と回答

**更新履歴:**
- 2025-08-18: 初版作成（Go版移植完了版）

**Note:** このガイドは継続的に更新されます。運用中に発見した知見やベストプラクティスを随時反映していきます。