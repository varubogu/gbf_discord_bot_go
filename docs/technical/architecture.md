# ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸

GBF Discord Bot (Goç‰ˆ) ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨æŠ€è¡“ä»•æ§˜ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

- [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ)
- [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ)
- [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
- [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ)

## ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›®æ¨™
- Pythonç‰ˆGBF Discord Botã®æ©Ÿèƒ½ã‚’Goã§å†å®Ÿè£…
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã¨ãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡ã®æ”¹å–„
- ä¿å®ˆæ€§ã¨ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®å‘ä¸Š
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®ç¢ºä¿

### ä¸»è¦æ©Ÿèƒ½
1. **Discord Bot åŸºç›¤**
   - Slash Commands ã¨ Prefix Commands ä¸¡å¯¾å¿œ
   - ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã¨ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
   - æ¨©é™ç®¡ç†ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

2. **ãƒãƒˆãƒ«å‹Ÿé›†ã‚·ã‚¹ãƒ†ãƒ **
   - ãƒãƒ«ãƒãƒãƒˆãƒ«å‹Ÿé›†æŠ•ç¨¿
   - å‚åŠ è€…ç®¡ç†ã¨ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
   - è‡ªå‹•æœŸé™åˆ‡ã‚Œå‡¦ç†

3. **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ **
   - å¤æˆ¦å ´ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥
   - ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
   - å®šæœŸã‚¿ã‚¹ã‚¯å®Ÿè¡Œ

4. **å¤–éƒ¨é€£æº**
   - Google Spreadsheeté€£æºï¼ˆè¨ˆç”»ä¸­ï¼‰
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºï¼ˆè¨ˆç”»ä¸­ï¼‰

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Discord API                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ WebSocket/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Discord Gateway                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Application Layer                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  cmd/bot/main.go                                        â”‚
â”‚  â”œâ”€â”€ Configuration Loading                              â”‚
â”‚  â”œâ”€â”€ Logger Initialization                              â”‚
â”‚  â”œâ”€â”€ Bot Instance Creation                              â”‚
â”‚  â””â”€â”€ Graceful Shutdown                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Bot Core Layer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  internal/discord/bot.go                                â”‚
â”‚  â”œâ”€â”€ Session Management                                 â”‚
â”‚  â”œâ”€â”€ Event Handler Registration                         â”‚
â”‚  â”œâ”€â”€ Command Routing                                    â”‚
â”‚  â””â”€â”€ Lifecycle Management                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Command Layer                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  internal/commands/                                     â”‚
â”‚  â”œâ”€â”€ ping.go     - Health Check Commands               â”‚
â”‚  â”œâ”€â”€ help.go     - Help & Documentation                â”‚
â”‚  â”œâ”€â”€ admin.go    - Administrative Commands             â”‚
â”‚  â”œâ”€â”€ battle.go   - Battle Information Commands         â”‚
â”‚  â””â”€â”€ (future)    - Recruitment Commands                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Domain Layer                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  internal/gbf/                                          â”‚
â”‚  â”œâ”€â”€ calc.go        - Battle Calculations              â”‚
â”‚  â”œâ”€â”€ battle.go      - Battle Management                â”‚
â”‚  â”œâ”€â”€ recruitment.go - Recruitment Management           â”‚
â”‚  â””â”€â”€ (future)       - Schedule Management              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Infrastructure Layer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  internal/config/  - Configuration Management          â”‚
â”‚  internal/log/     - Structured Logging                â”‚
â”‚  â””â”€â”€ (future)      - Database, External APIs           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆåŸå‰‡

#### 1. Application Layer
- **è²¬ä»»**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
- **ä¾å­˜**: Infrastructure Layer ã®ã¿
- **ç‰¹å¾´**: è–„ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€è¨­å®šã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

#### 2. Bot Core Layer
- **è²¬ä»»**: Discord API ã¨ã®é€šä¿¡ã€ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†
- **ä¾å­˜**: Command Layer, Infrastructure Layer
- **ç‰¹å¾´**: Discord å›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯é›†ç´„

#### 3. Command Layer
- **è²¬ä»»**: ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹
- **ä¾å­˜**: Domain Layer, Infrastructure Layer
- **ç‰¹å¾´**: å„ã‚³ãƒãƒ³ãƒ‰ã®ç‹¬ç«‹æ€§ç¢ºä¿

#### 4. Domain Layer
- **è²¬ä»»**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜
- **ä¾å­˜**: ãªã—ï¼ˆç´”ç²‹é–¢æ•°ä¸­å¿ƒï¼‰
- **ç‰¹å¾´**: ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„ã€å†åˆ©ç”¨å¯èƒ½

#### 5. Infrastructure Layer
- **è²¬ä»»**: å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã€æŠ€è¡“çš„é–¢å¿ƒäº‹
- **ä¾å­˜**: å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿
- **ç‰¹å¾´**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åŒ–ã€ãƒ¢ãƒƒã‚¯å¯¾å¿œ

## ğŸ’» æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### è¨€èªãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
```go
// Core Language
Go 1.21+ (æ¨å¥¨ 1.22+)

// Discord Integration
github.com/bwmarrin/discordgo v0.28.1

// Logging
log/slog (æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)

// Testing
æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª + Testify (optional)

// Configuration
æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (os.Getenv)
```

### å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ï¼ˆè¨ˆç”»ä¸­ï¼‰
```yaml
Database:
  - PostgreSQL 15+ (äºˆå®š)
  - GORM v2 (äºˆå®š)

External APIs:
  - Google Sheets API v4 (äºˆå®š)
  - Discord API v10 (ä½¿ç”¨ä¸­)

Infrastructure:
  - Docker & Docker Compose
  - GitHub Actions (CI/CD)
```

### é–‹ç™ºãƒ„ãƒ¼ãƒ«
```yaml
Code Quality:
  - golangci-lint
  - go fmt / go vet
  - staticcheck

Version Control:
  - Git
  - GitHub

Deployment:
  - Docker
  - Cross-platform builds
```

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
gbf_discord_bot_go/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ bot/
â”‚       â””â”€â”€ main.go              # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ commands/                # ã‚³ãƒãƒ³ãƒ‰å‡¦ç†å±¤
â”‚   â”‚   â”œâ”€â”€ ping.go
â”‚   â”‚   â”œâ”€â”€ help.go
â”‚   â”‚   â”œâ”€â”€ admin.go
â”‚   â”‚   â””â”€â”€ battle.go
â”‚   â”œâ”€â”€ discord/                 # Discord API é€£æºå±¤
â”‚   â”‚   â””â”€â”€ bot.go
â”‚   â”œâ”€â”€ gbf/                     # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”‚   â”œâ”€â”€ calc.go
â”‚   â”‚   â”œâ”€â”€ calc_test.go
â”‚   â”‚   â”œâ”€â”€ battle.go
â”‚   â”‚   â””â”€â”€ recruitment.go
â”‚   â”œâ”€â”€ config/                  # è¨­å®šç®¡ç†å±¤
â”‚   â”‚   â”œâ”€â”€ config.go
â”‚   â”‚   â””â”€â”€ config_test.go
â”‚   â””â”€â”€ log/                     # ãƒ­ã‚°ç®¡ç†å±¤
â”‚       â””â”€â”€ log.go
â”œâ”€â”€ docs/                        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ technical/
â”‚   â””â”€â”€ user/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ci.yml               # CI/CDè¨­å®š
â”œâ”€â”€ go.mod                       # Go ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©
â”œâ”€â”€ go.sum                       # ä¾å­˜é–¢ä¿‚ãƒãƒƒã‚·ãƒ¥
â”œâ”€â”€ .env.example                 # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .golangci.yml               # é™çš„è§£æè¨­å®š
â””â”€â”€ README.md                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­è¨ˆåŸå‰‡

#### `cmd/` - Applications
- å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
- è–„ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ä¸»ã«è¨­å®šã¨èµ·å‹•å‡¦ç†
- è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾å¿œå¯èƒ½

#### `internal/` - Private Packages
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯
- å¤–éƒ¨ã‹ã‚‰ã®importã‚’é˜²ã
- ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ†é›¢

#### `docs/` - Documentation
- åˆ©ç”¨è€…å‘ã‘ãƒ»é–‹ç™ºè€…å‘ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- Markdownãƒ™ãƒ¼ã‚¹
- ç¶™ç¶šçš„ãªæ›´æ–°ãŒå‰æ

## ğŸ”§ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### Bot Core (`internal/discord/bot.go`)

```go
type Bot struct {
    session       *discordgo.Session    // Discord ã‚»ãƒƒã‚·ãƒ§ãƒ³
    config        *config.Config        // è¨­å®š
    logger        *log.Logger          // ãƒ­ã‚¬ãƒ¼
    pingCommand   *commands.PingCommand // ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
    helpCommand   *commands.HelpCommand
    adminCommand  *commands.AdminCommand
    battleCommand *commands.BattleCommand
}
```

**è¨­è¨ˆåŸå‰‡:**
- å˜ä¸€è²¬ä»»åŸå‰‡: Discord API ã¨ã®é€šä¿¡ã«é›†ä¸­
- ä¾å­˜æ€§æ³¨å…¥: å„ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æ³¨å…¥
- ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†: èµ·å‹•ãƒ»åœæ­¢ãƒ»ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³

### Command System

```go
// ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæš—é»™çš„ï¼‰
type Command interface {
    HandlePrefixCommand(s *discordgo.Session, m *discordgo.MessageCreate)
    HandleSlashCommand(s *discordgo.Session, i *discordgo.InteractionCreate)
    GetSlashCommandDefinition() *discordgo.ApplicationCommand
}
```

**è¨­è¨ˆåŸå‰‡:**
- ã‚³ãƒãƒ³ãƒ‰ã®ç‹¬ç«‹æ€§: å„ã‚³ãƒãƒ³ãƒ‰ã¯ç‹¬ç«‹ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«
- ä¸¡å½¢å¼å¯¾å¿œ: Prefix (!cmd) ã¨ Slash (/cmd) ã®ä¸¡æ–¹
- çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹: åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…

### Domain Logic (`internal/gbf/`)

```go
// ç´”ç²‹é–¢æ•°ä¸­å¿ƒã®è¨­è¨ˆ
type AttackCalculator struct{}

func (c *AttackCalculator) CalculateBaseDamage(attack, defense int) int
func IsValidWeaponType(weaponType WeaponType) bool

// çŠ¶æ…‹ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åŒ–
type BattleManager struct {
    battles map[string]*BattleInfo
}

type RecruitmentManager struct {
    recruitments map[string]*Recruitment
    battleManager *BattleManager
}
```

**è¨­è¨ˆåŸå‰‡:**
- ç´”ç²‹é–¢æ•°å„ªå…ˆ: å‰¯ä½œç”¨ã®ãªã„é–¢æ•°ã‚’ä¸­å¿ƒã«
- ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã•: ãƒ¢ãƒƒã‚¯ãªã—ã§ãƒ†ã‚¹ãƒˆå¯èƒ½
- ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®é›†ç´„: GBFå›ºæœ‰ã®çŸ¥è­˜ã‚’ã“ã“ã«é›†ç´„

### Infrastructure Layer

```go
// è¨­å®šç®¡ç†
type Config struct {
    DiscordToken string
    LogLevel     string
    // å°†æ¥çš„ã«è¿½åŠ 
    DatabaseURL  string
    GoogleKeyFile string
}

// æ§‹é€ åŒ–ãƒ­ã‚°
type Logger struct {
    *slog.Logger
}

func (l *Logger) WithDiscordContext(guildID, channelID, userID string) *Logger
```

**è¨­è¨ˆåŸå‰‡:**
- å¤–éƒ¨ä¾å­˜ã®æŠ½è±¡åŒ–: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹
- è¨­å®šã®é›†ç´„: ç’°å¢ƒå¤‰æ•°ã®ä¸€å…ƒç®¡ç†
- å¯è¦³æ¸¬æ€§: æ§‹é€ åŒ–ãƒ­ã‚°ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’ä»˜ä¸

## ğŸŒŠ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. Discord Event
   â†“
2. Bot.onMessageCreate / Bot.onInteractionCreate
   â†“
3. Command Router (switchæ–‡)
   â†“
4. Specific Command Handler
   â†“
5. Domain Logic Execution
   â†“
6. Response Generation
   â†“
7. Discord API Response
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

```go
// çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³
func (cmd *SomeCommand) HandleCommand(s *discordgo.Session, m *discordgo.MessageCreate) {
    logger := cmd.logger.WithDiscordContext(m.GuildID, m.ChannelID, m.Author.ID).WithCommand("command")
    
    result, err := cmd.executeLogic()
    if err != nil {
        logger.WithError(err).Error("Command execution failed")
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        return
    }
    
    // æˆåŠŸæ™‚ã®å‡¦ç†
    logger.Info("Command executed successfully")
}
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### æ¨©é™ç®¡ç†

```go
// æ¨©é™ãƒã‚§ãƒƒã‚¯ã®çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³
func (a *AdminCommand) hasAdminPermission(s *discordgo.Session, guildID, userID string) bool {
    // 1. ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯
    // 2. gbf_bot_control ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
    // 3. ãƒ­ã‚°è¨˜éŒ²
    return authorized
}
```

### å…¥åŠ›æ¤œè¨¼

```go
// å…¥åŠ›å€¤ã®æ¤œè¨¼ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
func validateBattleID(battleID string) error {
    if len(battleID) == 0 {
        return errors.New("battle ID cannot be empty")
    }
    // è¿½åŠ ã®æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
    return nil
}
```

### ãƒ­ã‚°è¨­è¨ˆ

```go
// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã®è¨˜éŒ²
logger.WithDiscordContext(guildID, channelID, userID).
    WithCommand("admin").
    Info("Admin command executed successfully")

logger.WithError(err).
    WithUser(userID).
    Warn("Unauthorized access attempt")
```

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### ãƒ¡ãƒ¢ãƒªç®¡ç†

```go
// åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä½¿ç”¨
type BattleManager struct {
    battles map[string]*BattleInfo // O(1) ã‚¢ã‚¯ã‚»ã‚¹
}

// ãƒ¡ãƒ¢ãƒªãƒ—ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå°†æ¥çš„ã«å®Ÿè£…ï¼‰
var embedPool = sync.Pool{
    New: func() interface{} {
        return &discordgo.MessageEmbed{}
    },
}
```

### ä¸¦è¡Œå‡¦ç†

```go
// Graceful Shutdown ãƒ‘ã‚¿ãƒ¼ãƒ³
func (b *Bot) Start(ctx context.Context) error {
    // Context ã‚’ä½¿ç”¨ã—ãŸé©åˆ‡ãªåœæ­¢å‡¦ç†
    select {
    case <-ctx.Done():
        b.logger.Info("Bot stopping due to context cancellation")
    case <-stop:
        b.logger.Info("Bot stopping due to interrupt signal")
    }
    return b.Close()
}
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ€§èƒ½

```go
// Discord ã®3ç§’åˆ¶é™ã‚’è€ƒæ…®ã—ãŸå‡¦ç†
func (cmd *Command) HandleSlashCommand(s *discordgo.Session, i *discordgo.InteractionCreate) {
    // å³åº§ã« Acknowledge
    err := s.InteractionRespond(i.Interaction, &discordgo.InteractionResponse{
        Type: discordgo.InteractionResponseDeferredChannelMessageWithSource,
    })
    
    // é•·æ™‚é–“å‡¦ç†ã¯ goroutine ã§å®Ÿè¡Œ
    go func() {
        result := cmd.processLongTask()
        s.FollowupMessageCreate(i.Interaction, &discordgo.WebhookParams{
            Content: result,
        })
    }()
}
```

## ğŸ”„ æ‹¡å¼µæ€§è¨­è¨ˆ

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå°†æ¥ï¼‰

```go
// ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
type CommandPlugin interface {
    Name() string
    Register(bot *Bot) error
    Unregister(bot *Bot) error
}

// å‹•çš„ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²
func (b *Bot) RegisterPlugin(plugin CommandPlugin) error {
    return plugin.Register(b)
}
```

### è¨­å®šã®å¤–éƒ¨åŒ–

```go
// è¨­å®šã®æ®µéšçš„æ‹¡å¼µ
type Config struct {
    // ç¾åœ¨å®Ÿè£…æ¸ˆã¿
    DiscordToken string
    LogLevel     string
    
    // å°†æ¥ã®æ‹¡å¼µ
    DatabaseURL   string
    RedisURL      string
    GoogleKeyFile string
    Features      FeatureFlags
}

type FeatureFlags struct {
    EnableRecruitment bool
    EnableSchedule    bool
    EnableGSpread     bool
}
```

---

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:**
- [é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰](development-guide.md) - é–‹ç™ºç’°å¢ƒã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- [APIä»•æ§˜æ›¸](api-reference.md) - ã‚³ãƒãƒ³ãƒ‰ä»•æ§˜ã¨API
- [ç§»æ¤ã‚¬ã‚¤ãƒ‰](migration-guide.md) - Pythonç‰ˆã‹ã‚‰ã®å¤‰æ›´ç‚¹

**æ›´æ–°å±¥æ­´:**
- 2025-08-18: åˆç‰ˆä½œæˆï¼ˆGoç‰ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆå®Œäº†ï¼‰

**Note:** ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ç¶™ç¶šçš„ã«é€²åŒ–ã—ã¾ã™ã€‚æ–°æ©Ÿèƒ½ã®è¿½åŠ ã«ä¼´ã„ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚é©åˆ‡ã«æ›´æ–°ã—ã¦ã„ãã¾ã™ã€‚